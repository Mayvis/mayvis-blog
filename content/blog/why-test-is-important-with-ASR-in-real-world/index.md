---
title: Why test is important with ASR in real world
date: "2022-12-16T12:00:00.000Z"
description: å¹´æœ«äº†ï¼Œæœ€è¿‘å¿™å®Œäº†å¢¨é›¨çš„å…©å€‹å°ˆæ¡ˆï¼Œä¸€å€‹æ˜¯ç”¨ Nestjs Typescript å¯« API ä¸¦æ­é… Vue å¯«å¾Œå°ç®¡ç†ç³»çµ±ï¼Œç¸½ä¹‹å°±æ˜¯æ´»å‹•å ±åã€æœƒå“¡ã€å¯„ä¿¡ã€æª”æœŸ...ä¸€å †é›œä¸ƒé›œå…«çš„åŠŸèƒ½ï¼Œå¦ä¸€å€‹å‰‡ç›¸å°ç°¡å–®ï¼Œæ˜¯ç”¨ Strapi CMS å¼„çš„å¾Œå°ï¼Œæœ€å¾ŒåŒ…æˆ docker deploy åˆ° aws eb çš„æœå‹™ä¸Šé¢ï¼Œç”±æ–¼éƒ½å®Œæˆäº†ï¼Œç¸½ç®—è¼•é¬†ä¸€é»äº†...ã€‚æ‰€ä»¥å°±èŠ±é»æ™‚é–“ä¾†å¯«é€™ç¯‡æ–‡ç« ï¼Œä»Šå¤©ä¸»è¦æ˜¯è¦ä¾†ä»‹ç´¹ç‚ºä½• unit test å¾ˆé‡è¦ï¼Œæœƒç”¨æˆ‘å¯¦éš›é‡åˆ°çš„ä¸€å€‹å•é¡Œä¾†èªªæ˜ã€‚
tags: ["concept"]
---

### Preface

ASR åˆå«åš Automatic Speech Recognitionï¼Œæ˜¯ AI èªéŸ³è¾¨è­˜çš„ä¸€å€‹åŠŸèƒ½ï¼Œç°¡å–®ä¾†è¬›å°±æ˜¯å°‡äººèªªçš„è©±é€é AI è½‰æ›æˆæ–‡å­—ï¼Œç”±æ–¼é€™é …åŠŸèƒ½çš„å‡ºç¾ï¼Œå¯èƒ½å†éä¸ä¹…ï¼Œè½æ‰“å“¡çš„å·¥ä½œæœƒæ…¢æ…¢è½‰å‹æˆæ ¡ç¨¿ï¼Œç•¢ç«Ÿè¾¨è­˜çš„æº–ç¢ºç‡ä¹Ÿé€å¹´æ”€å‡ã€‚ä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œé‚„æ˜¯æœƒå‡ºç¾è¾¨è­˜ç‡å¾ˆä½çš„æƒ…æ³ï¼Œå¤§å¤šæ•¸é€™å–æ±ºæ–¼è¨“ç·´é›†æ˜¯å¦æœ‰å°è©²ä¸»é¡Œé€²è¡Œèª¿æ•™åŠè¨“ç·´ï¼Œè€Œç•¶æº–ç¢ºç‡ä½æ™‚ï¼Œå°±éœ€è¦æ¯”è¼ƒå³æ™‚çš„æ ¡ç¨¿ã€‚

### The problem

ç›´æ¥ä¸Šç¯„ä¾‹ï¼Œä¸‹é¢æ˜¯ ASR ç”¢å‡ºçš„æ–‡å­—ï¼Œå‡è¨­ä¸‹é¢ä¸‰çµ„è³‡æ–™å°± final äº†ï¼Œå°±èƒ½çµ¦è½æ‰“å“¡å»åšä¿®æ”¹ï¼Œé€™æ¨£çš„çµæœæ˜¯å¥½çš„ï¼Œä½†æ˜¯ç¾å¯¦æ˜¯ä»–å¯èƒ½è¦æ›´é«˜çš„çµ„æ•¸æ‰æœƒ final è®“è½æ‰“å“¡èƒ½ä¿®æ”¹ï¼Œé‚£é€™æ©Ÿåˆ¶å°æ–¼è½æ‰“å“¡å°±å¾ˆä¸å‹å–„äº†ï¼Œæ²’æœ‰è¾¦æ³•åšæ¯”è¼ƒå³æ™‚çš„æ ¡ç¨¿ï¼Œé€™æ˜¯æˆ‘å€‘ä¸æ¨‚è¦‹çš„ï¼Œæ‰€ä»¥è©²å¦‚ä½•è§£æ±ºé€™å•é¡Œå‘¢ï¼Ÿ

_Tip: final ä»£è¡¨ AI å°‡è©²å¥è¦–ç‚ºè¾¨è­˜å®Œæˆã€‚_

```js
const data = [
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ é€™æ™‚",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å°éº¥",
        final: 1,
      },
    ],
  }
]
```

### Brainstorming

åœ¨é–‹å§‹è…¦åŠ›æ¿€ç›ªä¹‹å‰ï¼Œé¦–å…ˆï¼Œæˆ‘å€‘é ˆå…ˆç†è§£ ASR è¾¨è­˜çš„æ©Ÿåˆ¶ï¼Œç›®å‰æˆ‘å€‘çš„èªéŸ³è¾¨è­˜æ©Ÿåˆ¶æ˜¯ä½¿ç”¨ trigram çš„æ–¹å¼ä¾†é€²è¡Œè¾¨è­˜ï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹è©å‡ºä¾†ä»–æœƒå»è§£æä»–çš„å‰å¾Œçš„è©ï¼Œç„¶å¾Œé€é AI é€²è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åˆ©ç”¨é€™å€‹ç‰¹æ€§ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œç°¡è€Œè¨€ä¹‹å°±æ˜¯ä¸‰è©æ˜¯ä¸€çµ„ï¼Œä½†ç©¶ç«Ÿè¦ç¬¬å€‹è©æ‰ä¸æœƒå½±éŸ¿åˆ°åŸå…ˆçš„ä¸‰è©å‘¢ï¼Œä¸‹é¢æˆ‘æœƒç”¨åœ–è§£çš„æ–¹å¼ä¾†é€²è¡Œèªªæ˜ã€‚

```bash
# * ä»£è¡¨ä¸€è©

      # ç”±æ–¼ä¸‰è©ä¸€çµ„çš„æ©Ÿåˆ¶ï¼Œç¬¬å››è©å‡ºä¾†å¾Œï¼Œæœƒå½±éŸ¿åˆ°å‰é¢çš„ç¬¬ä¸‰è©
    |
* * * *
        # ç¬¬äº”è©å‡ºä¾†å¾Œï¼Œåªæœƒå½±éŸ¿åˆ°ç¬¬å››è©ï¼Œä¸¦ä¸æœƒå½±éŸ¿åˆ°å‰é¢çš„ç¬¬ä¸‰è©
      |
* * * * *
```

é€éä¸Šé¢çš„æ¼”ç¤ºï¼Œæˆ‘å€‘å¯ä»¥å¾—çŸ¥ï¼Œåœ¨å¥å­å°šæœª final çš„æƒ…æ³ä¸‹ï¼Œäº”è©æ™‚å‰é¢ä¸‰è©æ˜¯ final çš„ï¼Œä¹Ÿå°±æ˜¯èƒ½æ‰”çµ¦è½æ‰“å“¡é€²è¡Œä¿®æ”¹ã€‚ç†è§£å®Œè¦å‰‡å¾Œï¼Œæ¥ä¸‹ä¾†å°±å¿…é ˆé©—è­‰åŠŸèƒ½æ˜¯å¦æ­£ç¢ºï¼Œè€Œæˆ‘ç›¸ä¿¡å¯«æ¸¬è©¦åœ¨é€™éšæ®µæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå°¤å…¶åŠŸèƒ½æ˜¯æ¯”è¼ƒéœ€è¦é‚è¼¯çš„ç¨‹å¼æ’°å¯«æ–¹é¢ï¼ŒTDD (Test-Driven Development) çš„é–‹ç™¼æ¨¡å¼å°±é¡¯å¾—æœ‰å®ƒçš„ç¨åˆ°ä¹‹è™•ï¼Œå‡è¨­æˆ‘å€‘åœ¨è…¦åŠ›æ¿€ç›ªé€™éšæ®µçš„æƒ³æ³•æ˜¯éŒ¯çš„ï¼Œä¾¿èƒ½é€éå¾ŒçºŒçš„æ¸¬è©¦çŸ¥é“çµæœæ˜¯ä¸å°çš„ï¼Œå·®ç•°ä¹Ÿèƒ½ç›´æ¥é€éæ¸¬è©¦ç¢¼å±•ç¾å‡ºä¾†ï¼Œè€Œæˆ‘è‡ªå·±ç›¸ç•¶å–œæ­¡ä¹Ÿé¼“å‹µå¤§å®¶æ’°å¯«é€™ç¨®é¡å‹çš„æ¸¬è©¦ï¼Œåœ¨å¾ŒçºŒé‹ç¶­ç•¶ä¸­ï¼Œæ¸¬è©¦æœƒæ…¢æ…¢é¡¯ç¤ºå®ƒçš„åƒ¹å€¼åœ¨ã€‚

### Unit test

é¦–å…ˆï¼Œæˆ‘å€‘å¯«äº†å…©çµ„æ¸¬è©¦åˆ†åˆ¥æ¸¬è©¦å…©å€‹ `takeRight` åŠ `take` é€™å…©å€‹ function ä¾†åˆ¤å®šæ˜¯å¦æœ‰é”åˆ°æˆ‘å€‘çš„éœ€æ±‚ï¼Œé †å¸¶ä¸€æï¼Œlodash ä¹Ÿæœ‰æä¾›é€™å€‹åŠŸèƒ½ã€‚

```js
// take.spec.js
const { take, takeRight } = require('./utils')

describe('take', () => {
  it("can take array value", () => {
    const arr = [1, 2, 3, 4, 5, 6];

    expect(take(arr, 3)).toStrictEqual([1, 2, 3]);
  });

  it("can take right value", () => {
    const arr = [1, 2, 3, 4, 5, 6];

    expect(takeRight(arr, 3)).toStrictEqual([6, 5, 4]);
  });
}), 
```

```js
function take(arr, take = 3) {
  const result = [];
  for (let i = 0; i < take; i++) {
    result.push(arr[i]);
  }

  return result;
}

function takeRight(arr, take = 3) {
  const len = arr.length;
  const result = [];
  for (let i = len - 1; i >= len - take; i--) {
    result.push(arr[i]);
  }

  return result;
}

module.exports = { take, takeRight };
```

ä¸‹é¢é€™çµ„çš„ unit test å°±ç•™çµ¦è®€è€…è‡ªå·±å®Œæˆäº†ï¼Œç°¡å–®ä¾†è¬›å°±æ˜¯ï¼Œå°‡ array è½‰æ›æˆå­—ä¸²ï¼Œä¸¦ä¸”æœ‰ç©ºæ ¼çš„ä¸€å€‹ functionã€‚

```js
// getTranscript.js
function getTranscript(arr, len) {
  let str = "";
  const re = /^[A-Za-z0-9]*$/;

  if (arr.length === 0) return str;

  take(arr, len).forEach((w) => {
    if (re.test(w[w.length - 1])) {
      str += ` ${w}`;
    } else {
      str += w;
    }
  });

  return str;
}
```

```js
// getTranscript.spec.js

// your turn ...
```

### Features test

é‚£æˆ‘å€‘å°±ä¾†å¯«æ•´å€‹åŠŸèƒ½çš„ features å§ï¼Œå…¶å¯¦æˆ‘æœ‰é€²è¡Œåˆªæ¸›ï¼Œæ­£å¸¸æƒ…æ³ä¸‹éœ€ mock websocketï¼Œä½†æˆ‘å€‘ç°¡å–®ä¸€é»ç”¨åƒ…ç”¨ array è³‡æ–™ä¾†æ¨¡æ“¬ã€‚

```js
// ASR.spec.js
const WORDS = 5; // you can try to change this word to 3 and you can see the difference

describe("ASR", () => {
  it("should get right output", () => {
    let previousArr = [];
    let tmpTranscript = "";

    // mimic asr websocket implement situation
    for (let i = 0; i < data.length; i++) {
      if (data[i].code === 200) {
        const { transcript, final } = data[i].result[0];
        const transcriptArr = transcript.split(" ") || [];
        const transcriptArrLength = transcriptArr.length;
        const o = getTranscript(transcriptArr, transcriptArrLength);
        const previousArrLength = previousArr.length;

        if (final === 0) {
          if (transcriptArrLength > WORDS) {
            let t = "";
            const diff = previousArrLength + WORDS - transcriptArrLength;

            if (diff > 0) {
              t = getTranscript(
                transcriptArr,
                transcriptArrLength - WORDS + diff
              );
            } else {
              t = getTranscript(transcriptArr, transcriptArrLength - WORDS);
            }

            if (previousArrLength !== 0) {
              const p = getTranscript(previousArr, previousArrLength);
              const re = new RegExp(p, "i");
              data[i].t = t.replace(re, "");
            } else {
              data[i].t = t;
            }

            if (diff > 0) {
              data[i].tmp = takeRight(transcriptArr, WORDS - diff);
              previousArr = take(
                transcriptArr,
                transcriptArrLength - WORDS + diff
              );
            } else {
              data[i].tmp = takeRight(transcriptArr, WORDS);
              previousArr = take(transcriptArr, transcriptArrLength - WORDS);
            }
          } else {
            // still smaller then WORDS, so ignore previousArr value, because the value might not be correct.
            data[i].t = "";
            data[i].tmp = transcriptArr;
          }
        } else {
          const p = getTranscript(previousArr, previousArrLength);
          const re = new RegExp(p, "i");
          data[i].t = o.replace(re, "");
          data[i].tmp = [];

          previousArr = [];
        }

        // console.log(data[i]);

        tmpTranscript += data[i].t.replace(/\s/g, "");
      }
    }

    expect(tmpTranscript).toEqual(
      data[data.length - 1].result[0].transcript.replace(/\s/g, "")
    );
  });
});
```

é™„ä¸Šå…©å¼µæ¸¬è©¦çµæœçš„åœ–ç‰‡ï¼Œæ¸¬è©¦å¤±æ•—çš„æ˜¯æˆ‘ WORD è¨­ç‚º 3ï¼Œæ‰€ä»¥æ¸¬è©¦æ˜¯å¤±æ•—çš„ï¼Œé€šéæ¸¬è©¦çš„å‰‡æ˜¯æˆ‘è¬› WORD è¨­ç‚º 5 çš„æƒ…æ³ã€‚

<img src='../../../src/assets/ASR-test-fail.png' alt='image'>
<br>
<img src='../../../src/assets/ASR-test-success.png' alt='image'>
<br>

æœ€å¾Œé™„ä¸Šå…©çµ„è¶…ç´šé•·çš„æ¸¬è©¦è³‡æ–™ï¼Œå¯ä»¥çµ¦è®€è€…å¯¦éš›æ¸¬è©¦çœ‹çœ‹ã€‚

```js
// sample data

// const data = [
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript: "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript: "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ ç–¾ç—…",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å«",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ æ¢¯",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† å",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ t",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ çš„ éŒ«ç¤¦",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±±",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±± æ›¿ è³‡æº ç›¸ç•¶ çè²´",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±± æ›¿ è³‡æº ç›¸ç•¶ çè²´ å…¨çƒ åªæœ‰ ä¸€",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±± æ›¿ è³‡æº ç›¸ç•¶ çè²´ å…¨çƒ åªæœ‰ ä¸€ç™¾ å…«å å¤šè¬ å™¸",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±± æ›¿ è³‡æº ç›¸ç•¶ çè²´ å…¨çƒ åªæœ‰ ä¸€ç™¾ å…«å å¤šè¬ å™¸ ä½† ä¸­åœ‹ å»",
//         final: 0,
//       },
//     ],
//   },
//   {
//     id: "b4fe6d16-906f-4383-b72c-2805a18497c5",
//     code: 200,
//     message: "è½‰è­¯æˆåŠŸ",
//     result: [
//       {
//         segment: 5,
//         transcript:
//           "ä¼åœ– ä¸­ å° è»äº‹ è¨­å‚™ æœ€ç‚º é‡è¦ çš„ è«éæ–¼ t é€™ å€‹ ç½•è¦‹ è³‡æº åŒ…å« ç‚¸è—¥ å’Œ æ­¦å™¨ ä»¥åŠ å¤œè¦–é¡ ç­‰ éƒ½ éœ€è¦ æ›¿ äºŒé›¶ä¸€ä¹å¹´ æˆ‘åœ‹ çš„ é‡‘å±¬ éŠ» ç”¢é‡ ä¸Šå‡ åˆ° äº† åè¬ äºº é€™ å…¶ä¸­ è²¢ç» æœ€ å¤§ çš„ å°± æ˜¯ æœ‰ æ¢¯åº¦ ç£å ´ éŒ«ç¤¦å±± æ›¿ è³‡æº ç›¸ç•¶ çè²´ å…¨çƒ åªæœ‰ ä¸€ç™¾ å…«å å¤šè¬ å™¸ ä½† ä¸­åœ‹ å» æŒæ¡ äº† ä¹åäº”",
//         final: 1,
//         startTime: 87.78,
//         endTime: 108.78,
//       },
//     ],
//   },
// ];

const data = [
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ é€™æ™‚",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å°éº¥",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å°éº¥ è‹— æƒ… è­¦å®¹ é¢¨ç´€",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript: "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå—",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹…",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª èµ°",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª èµ° çœ‹èµ·ä¾† æ¯”è¼ƒ æ”¿æ²»",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª èµ° çœ‹èµ·ä¾† æ¯”è¼ƒ è¿‘ä¼¼ æ–¼ é» çš„",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª èµ° çœ‹èµ·ä¾† æ¯”è¼ƒ è¿‘ä¼¼ æ–¼ é» çš„ è¶Šå— è—",
        final: 0,
      },
    ],
  },
  {
    id: "105f9cff-46e7-49a3-87ce-21b49566c018",
    code: 200,
    message: "è½‰è­¯æˆåŠŸ",
    result: [
      {
        segment: 16,
        transcript:
          "ä¸æ–™ ç½®èº« ç•°åœ‹ å®œè˜­ å†¬å±± å° å¥ˆè‰¯ æƒ…æ™¯ æ¢…èŠ±é¹¿ è·é›¢ æ–°ä½æ°‘ å‰µæ„ ç¾é£Ÿ å¤œå¸‚ ç‰›æ’ ç¨ä¸€ç„¡äºŒ å— è¶Šå— å°æ™‚ å é‚£éº¼ ä¹… ä¹Ÿ æ˜¯ æœ‰é» ç´¯ æˆ‘ æƒ³èªª èµ° çœ‹èµ·ä¾† æ¯”è¼ƒ è¿‘ä¼¼ æ–¼ é» çš„ è¶Šå— è’¼ å¤© ä¸­å¤® çš„ ç‰¹è‰²",
        final: 1,
        startTime: 129.78,
        endTime: 150.78,
      },
    ],
  },
];
```

### Conclusion

å…¶å¯¦é€™å°ˆæ¡ˆå·²ç¶“å®Œæˆå¾ˆä¹…äº†ï¼Œåªæ˜¯æˆ‘ç¾åœ¨æ‰å°‡å®ƒå¯«æˆä¸€ç¯‡æ–‡ç« ï¼Œè€å¯¦è¬›é€™å°ˆæ¡ˆé‚„é —è¤‡é›œçš„ï¼Œç”±æ–¼å…¬å¸æœå‹™æ˜¯ docker base çš„ï¼Œæ‰€ä»¥è¦å…ˆæå®š dockerï¼Œè³‡æ–™åº«ä½¿ç”¨ docker network çš„æ–¹å¼é€£æ¥ï¼Œæ’°å¯«å‰å°ä»‹é¢è·Ÿè¦æ’°å¯«ä¸€å€‹é¡ä¼¼ bridge çš„å¾Œç«¯æœå‹™è² è²¬æºé€šå‰å°åŠ ASRï¼Œåˆè¦è®“è½æ‰“å“¡èƒ½ä¿®æ”¹ä¸¦å„²å­˜åˆ°è³‡æ–™åº«ä¸­ï¼Œè™•ç† ASR websocket çš„è³‡æ–™ï¼ŒåŠå‰å°çš„è³‡æ–™éœ€è¦å³æ™‚èƒ½è·Ÿå¾Œå°é€²è¡ŒåŒæ­¥...ç­‰ï¼Œå¥½åœ¨æœ€å¾Œéƒ½èƒ½é †åˆ©è§£æ±ºğŸ˜…ã€‚

é‚£é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æƒ³é—¡è¿°æˆ‘èªç‚ºæ¸¬è©¦åœ¨é€™ç¨®éœ€è¦æ’°å¯«é‚è¼¯çš„ç¨‹å¼ç¢¼æ™‚ï¼Œæ˜¯ç›¸ç•¶é‡è¦çš„ï¼Œä»–èƒ½ç‚ºå¾ŒçºŒé‹ç¶­å¸¶ä¾†æ­£å‘çš„æ•ˆæ‡‰ï¼Œåƒæ˜¯ä¹‹å¾Œ ASR åŠŸèƒ½æœ‰å¾—åˆ°é¡¯è‘—çš„æå‡ï¼Œæˆ–è¨±ä¸ä½¿ç”¨ trigramï¼Œæˆ‘å€‘å‰‡éœ€è¦å°‡ WORD èª¿æ•´åˆ°é©åˆçš„ä½ç½®ä¸Šå°±èƒ½é€²è¡Œå¿«é€Ÿæ¸¬è©¦ï¼Œç›¸ç•¶æ–¹ä¾¿ï¼Œå¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½å°ä½ æœ‰æ‰€æ”¶ç©«ã€‚
